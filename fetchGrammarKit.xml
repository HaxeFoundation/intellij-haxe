<project name="Ant logic for downloading and extracting GrammarKit dependencies" default="grammarKit.setup" basedir=".">

  <import file="fetchCommon.xml"/>

  <description>

  </description>

  <!--Newer versions beyond 1.2.0 does not seem to work-->
  <property name="grammarKitVersion" value="1.2.0"/>

  <property name="grammarKitFile" value="${dependenciesDir}/GrammarKit-${grammarKitVersion}.zip"/>
  <property name="psiFile" value="${dependenciesDir}/light-psi-all-${grammarKitVersion}.jar"/>

  <property name="grammarKitTargetFile" value="${basedir}/grammar-kit.jar"/>
  <property name="psiTargetFile" value="${basedir}/light-psi-all.jar"/>

  <target name="grammarKit.setup">
    <antcall target="common.InitDependenciesDir"/>
    <antcall target="grammarKit.fetch"/>
    <antcall target="grammarKit.extract"/>
    <antcall target="psi.fetch"/>
    <antcall target="psi.extract"/>
  </target>

  <target name="grammarKit.checkDownload">
    <condition property="grammarKit.downloaded">
      <available file="${grammarKitFile}" type="file"/>
    </condition>
  </target>

  <target name="psi.checkDownload">
    <condition property="psi.downloaded">
      <available file="${psiFile}" type="file"/>
    </condition>
  </target>

  <target name="grammarKit.fetch" depends="grammarKit.checkDownload" unless="grammarKit.downloaded">
    <get dest="${grammarKitFile}" src="https://github.com/JetBrains/Grammar-Kit/releases/download/${grammarKitVersion}/GrammarKit.zip"/>
  </target>

  <target name="psi.fetch" depends="psi.checkDownload" unless="psi.downloaded">
    <get dest="${psiFile}" src="https://github.com/JetBrains/Grammar-Kit/releases/download/${grammarKitVersion}/light-psi-all.jar"/>
  </target>

  <target name="grammarKit.extract" depends="grammarKit.checkDownload" if="grammarKit.downloaded">
    <unzip src="${grammarKitFile}" dest="${dependenciesDir}"/>
    <copy file="${dependenciesDir}/GrammarKit/lib/grammar-kit.jar" tofile="${grammarKitTargetFile}"/>
  </target>

  <target name="psi.extract" depends="psi.checkDownload" if="psi.downloaded">
    <copy file="${psiFile}" tofile="${psiTargetFile}"/>
  </target>

</project>